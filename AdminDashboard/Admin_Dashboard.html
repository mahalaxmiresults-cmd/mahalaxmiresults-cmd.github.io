<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Result Update</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA39tWy3eQ7sImuHthW36icGSRdcCbH_CE",
  databaseURL: "https://mahalaxmi-result-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// FORM ELEMENTS
const citySelect = document.querySelector("select");
const dateInput = document.getElementById("dateInput");
const timeInput = document.getElementById("timeInput");
const resultInput = document.getElementById("resultInput");
const updateBtn = document.querySelector(".update-btn");
const gridBody = document.getElementById("gridBody");

// Auto date
dateInput.value = new Date().toISOString().split("T")[0];


// ===================
// SAVE FROM FORM
// ===================
updateBtn.addEventListener("click", () => {

    const city = citySelect.value;
    const date = dateInput.value;
    const time = timeInput.value;
    const result = resultInput.value;

    if (!date || !time || result === "") {
        alert("Fill all fields!");
        return;
    }

    const dateTime = `${date}T${time}`;

    set(ref(db, `results/${city}/${dateTime}`), {
        number: result
    }).then(() => {
        alert("Saved Successfully!");
        resultInput.value = "";
    });
});


// ===================
// LOAD GRID + INLINE EDIT
// ===================
function loadGrid() {
    onValue(ref(db, "results"), snapshot => {
        gridBody.innerHTML = "";
        const data = snapshot.val();
        if (!data) return;

        for (let city in data) {
            for (let dateTime in data[city]) {
                const number = data[city][dateTime].number;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${city}</td>
                    <td>${dateTime.replace("T"," ")}</td>
                    <td>
                        <input type="number" value="${number}" disabled class="grid-input">
                    </td>
                    <td>
                        <button class="edit-btn">Edit</button>
                    </td>
                `;

                const input = tr.querySelector(".grid-input");
                const btn = tr.querySelector(".edit-btn");

                btn.onclick = () => {
                    if (btn.innerText === "Edit") {
                        input.disabled = false;
                        input.focus();
                        btn.innerText = "Save";
                        btn.style.background = "#ff9800";
                    } else {
                        if (input.value === "") {
                            alert("Result required!");
                            return;
                        }

                        // UPDATE SAME FIREBASE RECORD
                        set(ref(db, `results/${city}/${dateTime}`), {
                            number: input.value
                        }).then(() => {
                            input.disabled = true;
                            btn.innerText = "Edit";
                            btn.style.background = "#4caf50";
                        });
                    }
                };

                gridBody.appendChild(tr);
            }
        }
    });
}

loadGrid();
</script>

<style>
body {
    margin: 0;
    padding: 0;
    font-family: Arial;
    background: #1e2633;
    color: #fff;
}
.container {
    width: 95%;
    max-width: 600px;
    margin: 40px auto;
}
h2 {
    text-align: center;
}
.form-card {
    background: #2c3444;
    padding: 20px;
    border-radius: 8px;
}
label {
    display: block;
    margin-bottom: 5px;
}
select, input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    background: #1f2733;
    border: none;
    color: #fff;
}
.update-btn {
    width: 100%;
    padding: 12px;
    background: #ff3f7f;
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 16px;
}

/* GRID */
table {
    width: 100%;
    margin-top: 30px;
    border-collapse: collapse;
    background: #2c3444;
}
th, td {
    border: 1px solid #444;
    padding: 8px;
    text-align: center;
}
th {
    background: #1f2733;
}
.grid-input {
    width: 70px;
    padding: 5px;
    background: #1f2733;
    border: none;
    color: #fff;
    text-align: center;
}
.edit-btn {
    padding: 5px 12px;
    background: #4caf50;
    border: none;
    color: #fff;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
    <h2>Result Update</h2>

    <!-- FORM (NEW ENTRY) -->
    <div class="form-card">
        <label>City</label>
        <select>
            <option>FARIDABAD</option>
            <option>MAHA LAXMI</option>
            <option>GURGAON</option>
            <option>DELHI BAZAAR</option>
            <option>SHREE GANESH</option>
            <option>GALI</option>
            <option>DISAWAR</option>
            <option>GHAZIABAD</option>
        </select>

        <label>Date</label>
        <input type="date" id="dateInput">

        <label>Time</label>
        <input type="time" id="timeInput">

        <label>Result</label>
        <input id="resultInput" type="number" placeholder="Result Number">

        <button class="update-btn">UPDATE</button>
    </div>

    <!-- GRID (EDIT EXISTING) -->
    <table>
        <thead>
            <tr>
                <th>City</th>
                <th>Date & Time</th>
                <th>Result</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="gridBody"></tbody>
    </table>
</div>

</body>
</html>
